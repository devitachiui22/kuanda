    <!DOCTYPE html>
    <html lang="pt-AO">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Detalhes do Pedido #<%= pedido.codigo %> | KuandaShop</title>
        
        <!-- Fontes Premium -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
        
        <!-- Frameworks -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

        <style>
            /* =========================================
            SISTEMA DE DESIGN X-PRO (FIGMA STYLE)
            ========================================= */
            :root {
                --bg: #F8F9FD;
                --primary: #0F0F0F;
                --accent: #8B0000;
                --surface: #FFFFFF;
                --text-main: #1A1A1B;
                --text-dim: #64748B;
                --radius-lg: 24px;
                --radius-md: 16px;
                --radius-sm: 12px;
                --shadow-lux: 0 10px 30px -5px rgba(0,0,0,0.04), 0 20px 40px -10px rgba(0,0,0,0.06);
            }

            body {
                background-color: var(--bg);
                font-family: 'Raleway', sans-serif;
                color: var(--text-main);
                -webkit-font-smoothing: antialiased;
                padding-bottom: 60px;
            }

            /* RESET & NAVBAR */
            a { text-decoration: none !important; color: inherit; transition: 0.3s; }
            
            .header-minimal {
                padding: 25px 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .brand-logo { font-weight: 900; font-size: 1.4rem; letter-spacing: -1px; }
            .brand-logo span { color: var(--accent); }

            .btn-back-pill {
                background: white;
                padding: 8px 16px;
                border-radius: 50px;
                font-weight: 700;
                font-size: 0.8rem;
                box-shadow: var(--shadow-lux);
                display: flex;
                align-items: center;
                gap: 8px;
                border: 1px solid rgba(0,0,0,0.05);
            }

            /* HERO SECTION */
            .order-hero {
                margin-bottom: 30px;
            }

            .order-code {
                font-weight: 900;
                font-size: 2rem;
                letter-spacing: -1.5px;
                margin-bottom: 5px;
            }

            .badge-status-top {
                font-weight: 800;
                font-size: 0.75rem;
                padding: 6px 16px;
                border-radius: 50px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            /* TRACKING TIMELINE PRO */
            .track-card {
                background: white;
                border-radius: var(--radius-lg);
                padding: 30px;
                box-shadow: var(--shadow-lux);
                margin-bottom: 25px;
                border: 1px solid rgba(0,0,0,0.02);
            }

            .pro-track {
                display: flex;
                justify-content: space-between;
                position: relative;
                margin: 20px 0;
            }

            .pro-track::before {
                content: '';
                position: absolute;
                top: 25px;
                left: 5%;
                width: 90%;
                height: 4px;
                background: #F1F5F9;
                z-index: 1;
            }

            .track-item {
                position: relative;
                z-index: 2;
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 25%;
            }

            .track-icon-box {
                width: 54px;
                height: 54px;
                background: white;
                border: 4px solid #F1F5F9;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 12px;
                transition: 0.4s;
            }

            .track-item.active .track-icon-box {
                border-color: #16A34A;
                background: #F0FDF4;
                transform: scale(1.1);
            }

            .track-icon-box img {
                width: 28px;
                opacity: 0.3;
                filter: grayscale(1);
            }

            .track-item.active .track-icon-box img {
                opacity: 1;
                filter: grayscale(0);
            }

            .track-label {
                font-size: 0.7rem;
                font-weight: 800;
                color: var(--text-dim);
                text-transform: uppercase;
            }

            .track-item.active .track-label { color: #16A34A; }

            /* TABELA DE ITENS (DESKTOP) */
            .items-card {
                background: white;
                border-radius: var(--radius-lg);
                overflow: hidden;
                box-shadow: var(--shadow-lux);
            }

            .card-header-lux {
                padding: 20px 25px;
                background: #FAFBFE;
                border-bottom: 1px solid #F1F5F9;
                font-weight: 800;
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .product-mini-img {
                width: 60px;
                height: 60px;
                object-fit: cover;
                border-radius: 12px;
                background: #f8f9fa;
            }

            /* SIDEBAR INFO */
            .info-panel {
                background: white;
                border-radius: var(--radius-lg);
                padding: 24px;
                margin-bottom: 20px;
                box-shadow: var(--shadow-lux);
            }

            .info-title {
                font-weight: 800;
                font-size: 0.85rem;
                color: var(--text-dim);
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 18px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .btn-whatsapp-pro {
                background: #25D366;
                color: white;
                border: none;
                width: 100%;
                padding: 14px;
                border-radius: 14px;
                font-weight: 800;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                box-shadow: 0 10px 20px rgba(37, 211, 102, 0.2);
            }

            .btn-whatsapp-pro:hover {
                transform: translateY(-2px);
                background: #20BA5A;
            }

            /* =========================================
            RESPONSIVIDADE: MATRIX 3x3 E MINIATURA
            ========================================= */
            @media (max-width: 600px) {
                .order-code { font-size: 1.5rem; }
                .pro-track::before { top: 20px; }
                .track-icon-box { width: 42px; height: 42px; border-width: 3px; }
                .track-icon-box img { width: 20px; }
                .track-label { font-size: 0.55rem; }

                /* MATRIZ DE PRODUTOS 3x3 */
                .table-responsive { display: none; } /* Esconde tabela no mobile */
                
                .items-matrix-mobile {
                    display: grid !important;
                    grid-template-columns: repeat(3, 1fr) !important;
                    gap: 12px;
                    padding: 15px;
                }

                .item-tile {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    text-align: center;
                    background: #F8FAFC;
                    padding: 10px 5px;
                    border-radius: 15px;
                }

                .tile-img {
                    width: 100%;
                    aspect-ratio: 1/1;
                    object-fit: cover;
                    border-radius: 10px;
                    margin-bottom: 8px;
                }

                .tile-name {
                    font-size: 0.65rem;
                    font-weight: 700;
                    margin-bottom: 4px;
                    height: 30px;
                    overflow: hidden;
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                }

                .tile-price {
                    font-size: 0.7rem;
                    font-weight: 900;
                    color: var(--accent);
                }

                .tile-qty {
                    font-size: 0.55rem;
                    font-weight: 800;
                    color: var(--text-dim);
                }
            }

            @media (min-width: 601px) {
                .items-matrix-mobile { display: none; }
            }
        </style>
    </head>
    <body>

        <div class="container">
            <!-- Minimal Header -->
            <header class="header-minimal">
                <a href="/" class="brand-logo">Kuanda<span>Shop</span></a>
                <div class="d-flex gap-2">
                    <a href="/meus-pedidos" class="btn-back-pill">
                        <i class="fas fa-chevron-left"></i> Meus Pedidos
                    </a>
                    <a href="/carrinho" class="btn-back-pill">
                        <img src="https://img.icons8.com/3d-fluency/94/shopping-cart.png" width="18" alt="">
                    </a>
                </div>
            </header>

            <!-- Order Hero -->
            <div class="order-hero d-flex justify-content-between align-items-end">
                <div>
                    <h1 class="order-code">Pedido #<%= pedido.codigo %></h1>
                    <p class="text-muted fw-600 mb-0">
                        <img src="https://img.icons8.com/3d-fluency/94/calendar.png" width="18" class="me-1">
                        <%= new Date(pedido.created_at).toLocaleDateString('pt-AO', { day: '2-digit', month: 'long', year: 'numeric' }) %>
                    </p>
                </div>
                <div>
                    <% 
                        let statusColor = '#64748B'; 
                        let statusBg = '#F1F5F9';
                        if(pedido.status === 'pendente') { statusColor = '#B45309'; statusBg = '#FEF3C7'; }
                        if(pedido.status === 'confirmado') { statusColor = '#0369A1'; statusBg = '#E0F2FE'; }
                        if(pedido.status === 'enviado') { statusColor = '#6D28D9'; statusBg = '#F5F3FF'; }
                        if(pedido.status === 'entregue') { statusColor = '#15803D'; statusBg = '#DCFCE7'; }
                        if(pedido.status === 'cancelado') { statusColor = '#B91C1C'; statusBg = '#FEE2E2'; }
                    %>
                    <span class="badge-status-top" style="color: <%= statusColor %>; background: <%= statusBg %>;">
                        <%= pedido.status %>
                    </span>
                </div>
            </div>

            <div class="row g-4">
                <!-- COLUNA ESQUERDA -->
                <div class="col-lg-8">
                    
                    <!-- Timeline Tracker -->
                    <% if (pedido.status !== 'cancelado') { %>
                        <div class="track-card">
                            <div class="info-title">Status do Rastreio</div>
                            <% 
                                let s1 = '', s2 = '', s3 = '', s4 = '';
                                if(['pendente', 'confirmado', 'processando', 'enviado', 'entregue'].includes(pedido.status)) s1 = 'active';
                                if(['confirmado', 'processando', 'enviado', 'entregue'].includes(pedido.status)) s2 = 'active';
                                if(['enviado', 'entregue'].includes(pedido.status)) s3 = 'active';
                                if(['entregue'].includes(pedido.status)) s4 = 'active';
                            %>
                            <div class="pro-track">
                                <div class="track-item <%= s1 %>">
                                    <div class="track-icon-box"><img src="https://img.icons8.com/?size=100&id=gTSfyL8663B4&format=png&color=000000"></div>
                                    <span class="track-label">Pedido</span>
                                </div>
                                <div class="track-item <%= s2 %>">
                                    <div class="track-icon-box"><img src="https://img.icons8.com/?size=100&id=f6iYkzgrDBct&format=png&color=000000"></div>
                                    <span class="track-label">Preparo</span>
                                </div>
                                <div class="track-item <%= s3 %>">
                                    <div class="track-icon-box"><img src="https://img.icons8.com/3d-fluency/94/delivery.png"></div>
                                    <span class="track-label">Rota</span>
                                </div>
                                <div class="track-item <%= s4 %>">
                                    <div class="track-icon-box"><img src="https://img.icons8.com/?size=100&id=h3USDbkfsNWM&format=png&color=000000"></div>
                                    <span class="track-label">Fim</span>
                                </div>
                            </div>
                        </div>
                    <% } else { %>
                        <div class="track-card bg-danger bg-opacity-10 border-danger border-opacity-25">
                            <div class="text-danger fw-bold d-flex align-items-center gap-2">
                                <img src="https://img.icons8.com/3d-fluency/94/cancel.png" width="24">
                                Este pedido foi cancelado e não seguirá para entrega.
                            </div>
                        </div>
                    <% } %>

                    <!-- Lista de Itens -->
                    <div class="items-card">
                        <div class="card-header-lux">
                            <img src="https://img.icons8.com/3d-fluency/94/shopping-basket.png" width="24">
                            Produtos no Pacote
                        </div>

                        <!-- Visual Desktop (Table) -->
                        <div class="table-responsive">
                            <table class="table align-middle mb-0">
                                <thead style="background: #FAFBFE; font-size: 0.75rem; text-transform: uppercase; color: var(--text-dim);">
                                    <tr>
                                        <th class="ps-4 py-3">Produto</th>
                                        <th class="text-center">Quantidade</th>
                                        <th class="text-end pe-4">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody style="border-top: none;">
                                    <% itens.forEach(item => { %>
                                        <tr>
                                            <td class="ps-4 py-3">
                                                <div class="d-flex align-items-center gap-3">
                                                    <img src="/uploads/produtos/<%= item.produto_imagem || 'default.jpg' %>" class="product-mini-img" onerror="this.src='https://via.placeholder.com/70'">
                                                    <div>
                                                        <h6 class="mb-0 fw-800" style="font-size: 0.95rem;"><%= item.produto_nome %></h6>
                                                        <small class="text-muted fw-600"><%= parseFloat(item.preco_unitario).toLocaleString() %> Kz / un</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="text-center fw-800">× <%= item.quantidade %></td>
                                            <td class="text-end pe-4 fw-900 text-dark">
                                                <%= (item.preco_unitario * item.quantidade).toLocaleString() %> Kz
                                            </td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>

                        <!-- Visual Mobile (Matrix 3x3) -->
                        <div class="items-matrix-mobile">
                            <% itens.forEach(item => { %>
                                <div class="item-tile">
                                    <img src="/uploads/produtos/<%= item.produto_imagem || 'default.jpg' %>" class="tile-img" onerror="this.src='https://via.placeholder.com/70'">
                                    <span class="tile-name"><%= item.produto_nome %></span>
                                    <span class="tile-qty">Qtd: <%= item.quantidade %></span>
                                    <span class="tile-price"><%= (item.preco_unitario * item.quantidade).toLocaleString() %> Kz</span>
                                </div>
                            <% }) %>
                        </div>

                        <!-- Rodapé de Total -->
                        <div class="p-4 d-flex justify-content-between align-items-center" style="background: var(--primary); color: white;">
                            <span class="fw-700 opacity-75 text-uppercase" style="font-size: 0.7rem; letter-spacing: 1px;">Valor Total do Pedido</span>
                            <span class="fw-900 fs-4"><%= parseFloat(pedido.total).toLocaleString() %> Kz</span>
                        </div>
                    </div>
                </div>

                <!-- COLUNA DIREITA -->
                <div class="col-lg-4">
                    
                    <!-- Loja Info -->
                    <div class="info-panel">
                        <div class="info-title">Vendedor</div>
                        <div class="d-flex align-items-center gap-3 mb-4">
                            <div style="width: 50px; height: 50px; background: var(--accent-light); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <img src="https://img.icons8.com/3d-fluency/94/shop.png" width="30">
                            </div>
                            <div>
                                <h6 class="mb-0 fw-800"><%= pedido.nome_loja %></h6>
                                <span class="badge bg-success bg-opacity-10 text-success fw-800" style="font-size: 0.6rem;">VERIFICADO</span>
                            </div>
                        </div>

                        <% if (pedido.vendedor_telefone) { %>
                            <% 
                                const zapMsg = encodeURIComponent(`Olá, sou cliente da KuandaShop. Gostaria de informações sobre o pedido #${pedido.codigo}.`);
                                const zapLink = `https://wa.me/${pedido.vendedor_telefone.replace(/\D/g, '')}?text=${zapMsg}`;
                            %>
                            <a href="<%= zapLink %>" target="_blank" class="btn-whatsapp-pro">
                                <i class="fab fa-whatsapp fs-5"></i> Contatar Vendedor
                            </a>
                        <% } %>
                    </div>

                    <!-- Entrega Info -->
                    <div class="info-panel">
                        <div class="info-title">Destino</div>
                        <div class="d-flex gap-3">
                            <img src="https://img.icons8.com/3d-fluency/94/marker.png" width="24" height="24">
                            <div>
                                <p class="mb-2 fw-700" style="font-size: 0.9rem; line-height: 1.4;"><%= pedido.endereco_entrega %></p>
                                <% if (pedido.observacoes) { %>
                                    <div style="background: #FFFBEB; color: #92400E; padding: 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700;">
                                        <strong>Obs:</strong> <%= pedido.observacoes %>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>

                    <!-- Pagamento Info -->
                    <div class="info-panel">
                        <div class="info-title">Pagamento</div>
                        <div class="d-flex align-items-center gap-3">
                            <img src="https://img.icons8.com/?size=100&id=AIPfWoh4WrhL&format=png&color=000000" width="32">
                            <div>
                                <h6 class="mb-0 fw-800"><%= pedido.metodo_pagamento %></h6>
                                <small class="text-muted fw-600">Método de Liquidação</small>
                            </div>
                        </div>
                    </div>

                    <!-- Ações -->
                    <% if (pedido.status === 'pendente') { %>
                        <form action="/meu-pedido/<%= pedido.id %>/cancelar" method="POST" onsubmit="return confirm('Confirmar cancelamento deste pedido?');">
                            <input type="hidden" name="motivo" value="Cancelado pelo cliente">
                            <button class="btn w-100 fw-800 py-3" style="color: #EF4444; background: #FEF2F2; border-radius: 14px;">
                                <i class="fas fa-times-circle me-2"></i> Solicitar Cancelamento
                            </button>
                        </form>
                    <% } %>

                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
    </html>