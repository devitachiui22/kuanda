<!DOCTYPE html>
<html lang="pt-AO">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gestão de Vendas | KuandaShop</title>

    <!-- Fontes e Ícones -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="shortcut icon" href="/image/png" type="/images/logo.png">


    <style>
        /* =========================================
           KUANDA PLATINUM DESIGN SYSTEM
           ========================================= */
        :root {
            --k-red: #E31C25;
            --k-black: #0F0F0F;
            --k-dark-gray: #1A1A1A;
            --k-light: #F8F9FA;
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 32px;
            
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --glass-blur: blur(20px);
            
            --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.05);
            --shadow-hover: 0 20px 50px -12px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #FAFAFA;
            color: var(--k-black);
            padding-top: 100px;
            padding-bottom: 80px;
            overflow-x: hidden; /* Evita scroll lateral indesejado */
        }

        a { text-decoration: none !important; transition: 0.3s ease; }

        /* --- NAVBAR FLUTUANTE --- */
        .nav-capsule {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 1100px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border); border-radius: 100px;
            padding: 10px 20px; z-index: 9999;
            box-shadow: var(--shadow-soft);
            display: flex; align-items: center; justify-content: space-between;
        }
        
        .brand-pill {
            display: flex; align-items: center; gap: 10px;
            background: white; padding: 5px 15px 5px 5px; border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* --- HERO CAROUSEL (BANNER) --- */
        .hero-wrap {
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            margin-bottom: 40px;
            position: relative;
            background: #000;
        }
        
        .hero-img {
            height: 200px; /* Altura padrão mobile */
            object-fit: cover;
            opacity: 0.9;
            transition: transform 0.5s ease;
        }
        
        .hero-wrap:hover .hero-img { transform: scale(1.03); }

        .hero-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
            padding: 40px 20px 20px;
            color: white;
            text-align: left;
        }
        .hero-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 2px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .hero-subtitle { font-size: 0.8rem; font-weight: 500; opacity: 0.9; color: #fbbf24; }

        @media (min-width: 768px) {
            .hero-img { height: 320px; }
            .hero-title { font-size: 1.5rem; }
        }

        /* --- DASHBOARD HEADER & KPI --- */
        .page-header h1 {
            font-size: 2rem; font-weight: 800; letter-spacing: -1px;
            background: linear-gradient(90deg, #0F0F0F, #444); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        .kpi-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 40px;
        }
        .kpi-card {
            background: white; border-radius: var(--radius-md); padding: 25px;
            border: 1px solid rgba(0,0,0,0.03); box-shadow: var(--shadow-soft);
            position: relative; overflow: hidden;
        }
        .kpi-value { font-size: 2rem; font-weight: 800; margin: 10px 0 0; }
        .kpi-sub { font-size: 0.8rem; font-weight: 600; }

        /* --- PAINEL PRINCIPAL --- */
        .glass-panel {
            background: white; border-radius: var(--radius-lg); padding: 30px;
            box-shadow: var(--shadow-soft); border: 1px solid rgba(0,0,0,0.02);
        }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .panel-title { font-size: 1.25rem; font-weight: 800; display: flex; align-items: center; gap: 10px; }

        /* TABELA DESKTOP */
        .table-custom { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        .table-custom th { font-size: 0.75rem; font-weight: 800; color: #94A3B8; text-transform: uppercase; padding: 0 15px 10px; }
        .table-custom td { padding: 20px 15px; background: white; border-top: 1px solid #f8f9fa; border-bottom: 1px solid #f8f9fa; font-size: 0.9rem; font-weight: 600; }
        .table-custom tbody tr { box-shadow: 0 2px 10px rgba(0,0,0,0.02); border-radius: 12px; }
        .table-custom td:first-child { border-top-left-radius: 12px; border-bottom-left-radius: 12px; border-left: 1px solid #f8f9fa; }
        .table-custom td:last-child { border-top-right-radius: 12px; border-bottom-right-radius: 12px; border-right: 1px solid #f8f9fa; }

        /* STATUS BADGES */
        .status-pill { padding: 6px 14px; border-radius: 50px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; }
        .st-pendente { background: #FFF7ED; color: #C2410C; }
        .st-confirmado { background: #EFF6FF; color: #1D4ED8; }
        .st-enviado { background: #F5F3FF; color: #7C3AED; }
        .st-entregue { background: #ECFDF5; color: #047857; }
        .st-cancelado { background: #FEF2F2; color: #B91C1C; }

        /* --- MOBILE MATRIX (3x3 OTIMIZADA) --- */
        .mobile-matrix { display: none; }

        @media (max-width: 991px) {
            .table-responsive-wrapper { display: none; } /* Esconde tabela */
            
            /* Ajuste do Painel para Mobile */
            .glass-panel { padding: 20px 15px; } /* Menos padding para ganhar espaço */

            .mobile-matrix { 
                display: grid; 
                grid-template-columns: repeat(3, 1fr); /* 3 colunas fixas */
                gap: 8px; /* Gap pequeno para caber */
                width: 100%;
            }

            .matrix-card {
                background: white; 
                border-radius: 16px; 
                padding: 12px 5px;
                text-align: center; 
                border: 1px solid #f1f5f9;
                display: flex; 
                flex-direction: column; 
                align-items: center; 
                justify-content: center;
                height: 100%; /* Altura uniforme */
                min-height: 110px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.02); 
                position: relative;
                overflow: hidden;
            }
            
            .matrix-card:active { transform: scale(0.96); background: #fafafa; }

            .mx-icon { 
                width: 32px; height: 32px; border-radius: 10px; margin-bottom: 6px;
                display: flex; align-items: center; justify-content: center; font-size: 0.9rem;
            }
            
            .mx-ref { 
                font-size: 0.65rem; 
                font-weight: 800; 
                color: #94A3B8; 
                margin-bottom: 2px;
                letter-spacing: -0.5px;
            }
            
            .mx-price { 
                font-size: 0.75rem; 
                font-weight: 800; 
                color: var(--k-black); 
                line-height: 1.1;
                width: 100%;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis; /* Trunca texto longo com ... */
                padding: 0 2px;
            }
            
            /* Indicador visual de status */
            .mx-status-bar {
                position: absolute; bottom: 0; left: 0; width: 100%; height: 3px;
            }
            
            .nav-capsule { width: 95%; padding: 8px 15px; }
        }
        
        /* Ajuste para telas MUITO pequenas (iPhone SE, Fold) */
        @media (max-width: 340px) {
            .mobile-matrix { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

    <!-- NAVBAR FLUTUANTE -->
    <nav class="nav-capsule">
        <div class="brand-pill">
            <img src="https://img.icons8.com/3d-fluency/94/shop.png" width="32" alt="Logo">
            <span class="fw-bold pe-2" style="font-size: 0.9rem;">Painel<span class="text-danger">.</span></span>
        </div>
        <div class="d-flex gap-2">
            <a href="/vendedor/" class="btn btn-dark rounded-pill px-3 btn-sm fw-bold">
                <i class="fas fa-tachometer-alt"></i>
            </a>
            <a href="/perfil" class="btn btn-light border rounded-pill px-3 btn-sm text-muted">
                <i class="fas fa-user"></i>
            </a>
        </div>
    </nav>

    <div class="container">
        
        <!-- HEADER -->
        <header class="page-header mb-4 mt-4">
            <h1>Gestão de Vendas</h1>
            <p>Resumo da loja de <%= user.nome.split(' ')[0] %>.</p>
        </header>

        <!-- NOVO: HERO BANNER CAROUSEL (Solicitado) -->
        <div class="hero-wrap">
            <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <!-- Slide 1 -->
                    <div class="carousel-item active" data-bs-interval="4000">
                        <a href="https://kuanda.onrender.com/filme/14" target="_blank" class="d-block w-100 h-100">
                            <img src="https://kuanda.onrender.com/uploads/filmes/imagem-7-1767361160596-862867324.webp" class="hero-img w-100" alt="Filme Destaque">
                            <div class="hero-overlay">
                                <div class="hero-title">Estreia Exclusiva</div>
                                <div class="hero-subtitle">Assista agora no Kuanda <i class="fas fa-arrow-right ms-1"></i></div>
                            </div>
                        </a>
                    </div>
                    <!-- Slide 2 -->
                    <div class="carousel-item" data-bs-interval="4000">
                        <a href="https://kuanda.onrender.com/game/12" target="_blank" class="d-block w-100 h-100">
                            <img src="https://i.ytimg.com/vi/J-EHvQ7HgUM/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLBw-3r8GaFvFTtsTsq3n85_K2d8rQ" class="hero-img w-100" alt="Games">
                            <div class="hero-overlay">
                                <div class="hero-title">Mundo Gamer</div>
                                <div class="hero-subtitle">Novos lançamentos disponíveis <i class="fas fa-gamepad ms-1"></i></div>
                            </div>
                        </a>
                    </div>
                    <!-- Slide 3 -->
                    <div class="carousel-item" data-bs-interval="4000">
                        <a href="https://kuanda.onrender.com/produto/7" target="_blank" class="d-block w-100 h-100">
                            <img src="/images/site.jpg" class="hero-img w-100" alt="Produtos"> <!-- Nota: Caminho local pode quebrar se a imagem não existir -->
                            <div class="hero-overlay">
                                <div class="hero-title">Ofertas da Semana</div>
                                <div class="hero-subtitle">Descontos imperdíveis <i class="fas fa-tag ms-1"></i></div>
                            </div>
                        </a>
                    </div>
                    <!-- Slide 4 -->
                    <div class="carousel-item" data-bs-interval="4000">
                        <a href="https://kuanda.onrender.com/filme/2" target="_blank" class="d-block w-100 h-100">
                            <img src="https://kuanda.onrender.com/uploads/filmes/imagem-7-1767379440078-175525311.jpeg" class="hero-img w-100" alt="Cinema">
                            <div class="hero-overlay">
                                <div class="hero-title">Sessão Pipoca</div>
                                <div class="hero-subtitle">Os melhores filmes aqui <i class="fas fa-play-circle ms-1"></i></div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- KPI CARDS -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <span class="kpi-label">Receita</span>
                <h3 class="kpi-value"><%= parseFloat(stats.receita_total).toLocaleString('pt-AO') %> <small style="font-size: 1rem; color:#999">Kz</small></h3>
                <span class="kpi-sub text-success"><i class="fas fa-arrow-up me-1"></i>Confirmado</span>
            </div>
            <div class="kpi-card">
                <span class="kpi-label">Aguardando</span>
                <h3 class="kpi-value"><%= stats.pendentes %></h3>
                <span class="kpi-sub text-warning"><i class="fas fa-clock me-1"></i>Pedidos</span>
            </div>
            <div class="kpi-card">
                <span class="kpi-label">Total</span>
                <h3 class="kpi-value"><%= stats.total_pedidos %></h3>
                <span class="kpi-sub text-primary"><i class="fas fa-box me-1"></i>Geral</span>
            </div>
        </div>

        <!-- PAINEL DE PEDIDOS -->
        <div class="glass-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <img src="https://img.icons8.com/fluency/48/order-history.png" width="32">
                    Pedidos Recentes
                </div>
            </div>

            <!-- VERSÃO DESKTOP -->
            <div class="table-responsive-wrapper">
                <table class="table-custom">
                    <thead>
                        <tr>
                            <th>Ref</th>
                            <th>Cliente</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Data</th>
                            <th class="text-end">Ação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (pedidos.length === 0) { %>
                            <tr><td colspan="6" class="text-center py-4">Sem vendas ainda.</td></tr>
                        <% } else { %>
                            <% pedidos.forEach(p => { %>
                                <tr>
                                    <td><span class="badge bg-light text-dark">#<%= p.codigo || p.id %></span></td>
                                    <td><%= p.cliente_nome %></td>
                                    <td class="text-danger"><%= parseFloat(p.total).toLocaleString() %> Kz</td>
                                    <td>
                                        <% let stClass = 'st-pendente';
                                           if(p.status === 'confirmado') stClass = 'st-confirmado';
                                           if(p.status === 'enviado') stClass = 'st-enviado';
                                           if(p.status === 'entregue') stClass = 'st-entregue';
                                           if(p.status === 'cancelado') stClass = 'st-cancelado'; %>
                                        <span class="status-pill <%= stClass %>"><%= p.status %></span>
                                    </td>
                                    <td class="small text-muted"><%= new Date(p.created_at).toLocaleDateString('pt-AO') %></td>
                                    <td class="text-end"><a href="/vendedor/pedido/<%= p.id %>" class="btn btn-dark btn-sm rounded-pill">Ver</a></td>
                                </tr>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>

            <!-- VERSÃO MOBILE (MATRIX 3x3 OTIMIZADA) -->
            <div class="mobile-matrix">
                <% if (pedidos.length === 0) { %>
                    <div class="col-12 text-center py-4 text-muted" style="grid-column: span 3;">
                        <small>Sem vendas recentes.</small>
                    </div>
                <% } else { %>
                    <% pedidos.forEach(p => { %>
                        <% 
                            let iconBg = '#FEF3C7'; let iconColor = '#D97706'; let iconClass = 'fa-clock'; 
                            if(p.status === 'entregue') { iconBg = '#DCFCE7'; iconColor = '#16A34A'; iconClass = 'fa-check'; }
                            if(p.status === 'cancelado') { iconBg = '#FEE2E2'; iconColor = '#DC2626'; iconClass = 'fa-times'; }
                            if(p.status === 'enviado') { iconBg = '#F3E8FF'; iconColor = '#7C3AED'; iconClass = 'fa-truck'; }
                            if(p.status === 'confirmado') { iconBg = '#DBEAFE'; iconColor = '#1D4ED8'; iconClass = 'fa-thumbs-up'; }
                        %>
                        <a href="/vendedor/pedido/<%= p.id %>" class="matrix-card">
                            <div class="mx-icon" style="background: <%= iconBg %>; color: <%= iconColor %>;">
                                <i class="fas <%= iconClass %>"></i>
                            </div>
                            <span class="mx-ref">#<%= p.codigo || p.id %></span>
                            <span class="mx-price"><%= parseFloat(p.total).toLocaleString() %></span>
                            
                            <!-- Barra de Status na parte inferior do card -->
                            <div class="mx-status-bar" style="background: <%= iconColor %>;"></div>
                        </a>
                    <% }) %>
                <% } %>
            </div>

        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>